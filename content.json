{"meta":{"title":"阿Ben的网络日志","subtitle":"记录我的学习笔记与生活感想","description":"","author":"John Doe","url":"http://example.com"},"pages":[],"posts":[{"title":"如何离线升级openssh和openssl","slug":"离线升级opensshopenssl","date":"2022-08-28T10:30:00.000Z","updated":"2022-08-29T05:09:33.106Z","comments":true,"path":"2022/08/28/离线升级opensshopenssl/","link":"","permalink":"http://example.com/2022/08/28/%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7opensshopenssl/","excerpt":"","text":"如何离线升级openssh和openssl1、环境检查 先确保你的服务器上已经有gcc，gcc-c++。这两个是编译工具。 1rpm -qa |grep gcc 缺少 正常应该是这样 缺少则安装gcc等编译环境 123#把相关的rpm包全部放到gcc文件夹#进入gcc文件夹，忽略依赖安装rpm -Uvh --force --nodeps *.rpm 2、编译安装openssl下载最新版：https://mirrors.cloud.tencent.com/openssl/source/ 123456789101112131415161718192021222324252627282930313233#备份旧版mv /usr/lib64/libcrypto.so.1.0.2k /usr/lib64/libcrypto.so.1.0.2k_bak mv /usr/lib64/libssl.so.1.0.2k /usr/lib64/libssl.so.1.0.2k_bak #解压tar -zxvf openssl-1.0.2k.tar.gzcd openssl-1.0.2k#添加openssl配置./config --prefix=/usr/local/openssl#编译make#卸载旧版本for i in $(rpm -qa |grep openssl);do rpm -e $i --nodeps ;done#安装make install#配置相关软链echo &quot;/usr/local/openssl/lib&quot; &gt;&gt; /etc/ld.so.confldconfigcp /usr/local/openssl/lib/libssl.so.1.1 /lib64/libssl.so.1.1cp -f /usr/local/openssl/lib/libssl.so.1.1 /usr/lib64/libssl.so.1.1cp /usr/local/openssl/lib/libcrypto.so.1.1 /usr/lib64ln -sf /usr/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.10ln -sf /usr/lib64/libcrypto.so.1.1 /lib64/libcrypto.so.10ln -sf /usr/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.soln -sf /usr/lib64/libssl.so.1.1 /usr/lib64/libssl.so.10ln -sf /usr/lib64/libssl.so.1.1 /usr/lib64/libssl.soln -sf /usr/local/openssl/bin/openssl /usr/bin/opensslln -sf /usr/local/openssl/include/openssl /usr/include/opensslopenssl version -a#修改1.0版软链mv /usr/lib64/libcrypto.so.1.0.2k_bak /usr/lib64/libcrypto.so.1.0.2kln -fs /usr/lib64/libcrypto.so.1.0.2k /usr/lib64/libcrypto.so.10mv /usr/lib64/libssl.so.1.0.2k_bak /usr/lib64/libssl.so.1.0.2kln -sf /usr/lib64/libssl.so.1.0.2k /usr/lib64/libssl.so.10 3、编译安装openssh下载最新版：https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 12345678910111213141516171819202122232425262728#进入openssh文件夹，并配置./configure --prefix=/usr --sysconfdir=/etc/ssh --with-ssl-dir=/usr/local/openssl#执行makemake#卸载 旧版本的opensshfor i in $(rpm -qa |grep openssh);do rpm -e $i --nodeps ;done#安装新版本opensshsudo make install#查看新版的本号ssh -V// 在使用ssh登陆试试sudo cp contrib/redhat/sshd.init /etc/init.d/sshd#加入开机启动sudo chkconfig --add sshdsudo chkconfig sshd on# 修改配置 PermitRootLogin yessudo vim /etc/ssh/sshd_configecho &quot;PermitRootLogin yes&quot; &gt;&gt; /etc/ssh/sshd_config// 重启服务sudo service sshd restart 123chmod 600 /etc/ssh/ssh_host_rsa_keychmod 600 /etc/ssh/ssh_host_ecdsa_keychmod 600 /etc/ssh/ssh_host_ed25519_key 4、升级后的问题1）无法登陆ssh12临时关闭 setenforce 0 #设置SELinux 成为permissive模式 setenforce 1 设置SELinux 成为enforcing模式 修改配置文件需要重启服务器 修改/etc/selinux/config 文件，将SELINUX=enforcing改为SELINUX=disabled 2）docker网络异常重启docker服务 1systemctl restart docker 3）Sftp账号异常因为&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件更新后为全新文件，相关的配置也会被修改。需按照升级前的配置修改。","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[],"keywords":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}]}]}